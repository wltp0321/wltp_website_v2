{% extends "base.html" %}
{% block title %}프로젝트 소개 - IMPERIUM Crew{% endblock %}

{% block content %}
<section class="py-16 bg-gray-50">
  <div class="max-w-6xl mx-auto px-6 text-center">
    <h1 class="text-4xl font-bold text-gray-900 mb-4">프로젝트 소개</h1>
    <p class="text-gray-600 mb-12">IMPERIUM Crew 프로젝트를 확인하세요.</p>

    {% if request.user.is_staff %}
    <div class="mb-12">
      <a href="{% url 'projects:create' %}" 
         class="inline-block bg-yellow-400 text-gray-900 font-semibold py-2 px-6 rounded-lg hover:bg-yellow-500 transition">
         새 프로젝트 추가
      </a>
    </div>
    {% endif %}

    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8">
      {% for project in projects %}
      <div class="rounded-2xl shadow hover:shadow-lg transition p-6 flex flex-col
          {% if project.status == '완료' %}bg-green-100 text-green-900
          {% elif project.status == '중지' %}bg-gray-200 text-gray-800
          {% else %}bg-white text-gray-900{% endif %}"
          data-project-id="{{ project.id }}">
        
        <!-- 프로젝트 제목 + 상태 -->
        <div class="flex justify-between items-center mb-2">
          <h2 class="text-xl font-semibold">{{ project.name }}</h2>
          <span class="text-sm px-2 py-1 rounded-full
            {% if project.status == '완료' %}bg-green-200 text-green-800
            {% elif project.status == '중지' %}bg-yellow-200 text-yellow-800
            {% else %}bg-blue-100 text-blue-800{% endif %}">
            {% if project.status == '완료' %}완료
            {% elif project.status == '중지' %}중지
            {% else %}진행 중{% endif %}
          </span>
        </div>

        <p class="mb-2 text-gray-600 text-sm leading-relaxed">{{ project.description|truncatewords:20 }}</p>
        <p class="text-gray-400 text-xs mb-4 github-last-update">Loading last update...</p>

        <div class="mt-auto flex flex-wrap justify-center gap-2">
          {% if project.detail_url %}
          <a href="{{ project.detail_url }}" target="_blank"
             class="bg-yellow-400 text-gray-900 py-1 px-3 rounded hover:bg-yellow-500 transition">
             자세히 보기
          </a>
          {% else %}
          <a href="{% url 'projects:detail' project.id %}"
             class="bg-yellow-400 text-gray-900 py-1 px-3 rounded hover:bg-yellow-500 transition">
             자세히 보기
          </a>
          {% endif %}

          {% if request.user.is_staff %}
          <a href="{% url 'projects:edit' project.id %}" 
             class="bg-blue-500 text-white py-1 px-3 rounded hover:bg-blue-600 transition">
             수정
          </a>
          <a href="{% url 'projects:delete' project.id %}" 
             class="bg-red-500 text-white py-1 px-3 rounded hover:bg-red-600 transition">
             삭제
          </a>
          {% endif %}
        </div>
      </div>

      {% empty %}
      <p class="text-gray-500 col-span-full text-center">등록된 프로젝트가 없습니다.</p>
      {% endfor %}
    </div>
  </div>
</section>

<script>
document.addEventListener("DOMContentLoaded", function() {
  document.querySelectorAll("[data-project-id]").forEach(function(card) {
    const projectId = card.dataset.projectId;
    const lastUpdateElem = card.querySelector(".github-last-update");

    fetch(`/projects/${projectId}/github_last_update/`)
      .then(response => response.json())
      .then(data => {
        if (data.last_update) {
          const date = new Date(data.last_update);
          lastUpdateElem.textContent = `Last Update: ${date.toLocaleString()}`;
        } else {
          lastUpdateElem.textContent = `Last Update: N/A`;
        }
      })
      .catch(() => {
        lastUpdateElem.textContent = `Last Update: N/A`;
      });
  });
});
</script>
{% endblock %}
